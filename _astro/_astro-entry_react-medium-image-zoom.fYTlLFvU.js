import{R as l,a as ie}from"./index.oSdPxYgj.js";function ae(){return l.createElement("svg",{"aria-hidden":"true","data-rmiz-btn-unzoom-icon":!0,fill:"currentColor",focusable:"false",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},l.createElement("path",{d:"M 14.144531 1.148438 L 9 6.292969 L 9 3 L 8 3 L 8 8 L 13 8 L 13 7 L 9.707031 7 L 14.855469 1.851563 Z M 8 8 L 3 8 L 3 9 L 6.292969 9 L 1.148438 14.144531 L 1.851563 14.855469 L 7 9.707031 L 7 13 L 8 13 Z"}))}function re(){return l.createElement("svg",{"aria-hidden":"true","data-rmiz-btn-zoom-icon":!0,fill:"currentColor",focusable:"false",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},l.createElement("path",{d:"M 9 1 L 9 2 L 12.292969 2 L 2 12.292969 L 2 9 L 1 9 L 1 14 L 6 14 L 6 13 L 2.707031 13 L 13 2.707031 L 13 6 L 14 6 L 14 1 Z"}))}const T=(t,e)=>t===e?.tagName?.toUpperCase?.(),N=t=>T("DIV",t)||T("SPAN",t),R=t=>T("IMG",t),G=t=>t.complete&&t.naturalHeight!==0,D=t=>T("SVG",t),P=({height:t,offset:e,width:n})=>Math.min((window.innerWidth-e*2)/n,(window.innerHeight-e*2)/t),le=({containerHeight:t,containerWidth:e,offset:n,targetHeight:o,targetWidth:i})=>{const a=P({height:o,offset:n,width:i}),m=i>o?i/e:o/t;return a>1?m:a*m},S=({containerHeight:t,containerWidth:e,hasScalableSrc:n,offset:o,targetHeight:i,targetWidth:a})=>!t||!e?1:!n&&i&&a?le({containerHeight:t,containerWidth:e,offset:o,targetHeight:i,targetWidth:a}):P({height:t,offset:o,width:e}),de=/url(?:\(['"]?)(.*?)(?:['"]?\))/,X=t=>{if(t){if(R(t))return t.currentSrc;if(N(t)){const e=window.getComputedStyle(t).backgroundImage;if(e)return de.exec(e)?.[1]}}},he=t=>{if(t)return R(t)?t.alt??void 0:t.getAttribute("aria-label")??void 0},ce=({containerHeight:t,containerLeft:e,containerTop:n,containerWidth:o,hasScalableSrc:i,offset:a,targetHeight:m,targetWidth:u})=>{const r=S({containerHeight:t,containerWidth:o,hasScalableSrc:i,offset:a,targetHeight:m,targetWidth:u});return{top:n,left:e,width:o*r,height:t*r,transform:`translate(0,0) scale(${1/r})`}},g=({position:t,relativeNum:e})=>{const n=parseFloat(t);return t.endsWith("%")?e*n/100:n},me=({containerHeight:t,containerLeft:e,containerTop:n,containerWidth:o,hasScalableSrc:i,objectFit:a,objectPosition:m,offset:u,targetHeight:r,targetWidth:s})=>{if(a==="scale-down"&&(s<=o&&r<=t?a="none":a="contain"),a==="cover"||a==="contain"){const h=o/s,p=t/r,d=a==="cover"?Math.max(h,p):Math.min(h,p),[f="50%",v="50%"]=m.split(" "),E=g({position:f,relativeNum:o-s*d}),c=g({position:v,relativeNum:t-r*d}),w=S({containerHeight:r*d,containerWidth:s*d,hasScalableSrc:i,offset:u,targetHeight:r,targetWidth:s});return{top:n+c,left:e+E,width:s*d*w,height:r*d*w,transform:`translate(0,0) scale(${1/w})`}}else if(a==="none"){const[h="50%",p="50%"]=m.split(" "),d=g({position:h,relativeNum:o-s}),f=g({position:p,relativeNum:t-r}),v=S({containerHeight:r,containerWidth:s,hasScalableSrc:i,offset:u,targetHeight:r,targetWidth:s});return{top:n+f,left:e+d,width:s*v,height:r*v,transform:`translate(0,0) scale(${1/v})`}}else if(a==="fill"){const h=o/s,p=t/r,d=Math.max(h,p),f=S({containerHeight:r*d,containerWidth:s*d,hasScalableSrc:i,offset:u,targetHeight:r,targetWidth:s});return{width:o*f,height:t*f,transform:`translate(0,0) scale(${1/f})`}}else return{}},ue=({backgroundPosition:t,backgroundSize:e,containerHeight:n,containerLeft:o,containerTop:i,containerWidth:a,hasScalableSrc:m,offset:u,targetHeight:r,targetWidth:s})=>{if(e==="cover"||e==="contain"){const h=a/s,p=n/r,d=e==="cover"?Math.max(h,p):Math.min(h,p),[f="50%",v="50%"]=t.split(" "),E=g({position:f,relativeNum:a-s*d}),c=g({position:v,relativeNum:n-r*d}),w=S({containerHeight:r*d,containerWidth:s*d,hasScalableSrc:m,offset:u,targetHeight:r,targetWidth:s});return{top:i+c,left:o+E,width:s*d*w,height:r*d*w,transform:`translate(0,0) scale(${1/w})`}}else if(e==="auto"){const[h="50%",p="50%"]=t.split(" "),d=g({position:h,relativeNum:a-s}),f=g({position:p,relativeNum:n-r}),v=S({containerHeight:r,containerWidth:s,hasScalableSrc:m,offset:u,targetHeight:r,targetWidth:s});return{top:i+f,left:o+d,width:s*v,height:r*v,transform:`translate(0,0) scale(${1/v})`}}else{const[h="50%",p="50%"]=e.split(" "),d=g({position:h,relativeNum:a}),f=g({position:p,relativeNum:n}),v=d/s,E=f/r,c=Math.min(v,E),[w="50%",z="50%"]=t.split(" "),b=g({position:w,relativeNum:a-s*c}),I=g({position:z,relativeNum:n-r*c}),L=S({containerHeight:r*c,containerWidth:s*c,hasScalableSrc:m,offset:u,targetHeight:r,targetWidth:s});return{top:i+I,left:o+b,width:s*c*L,height:r*c*L,transform:`translate(0,0) scale(${1/L})`}}},fe=/\.svg$/i,pe=({hasZoomImg:t,imgSrc:e,isSvg:n,isZoomed:o,loadedImgEl:i,offset:a,shouldRefresh:m,targetEl:u})=>{const r=n||e?.slice?.(0,18)==="data:image/svg+xml"||t||!!(e&&fe.test(e)),s=u.getBoundingClientRect(),h=window.getComputedStyle(u),p=i!=null&&N(u),d=i!=null&&!p,f=ce({containerHeight:s.height,containerLeft:s.left,containerTop:s.top,containerWidth:s.width,hasScalableSrc:r,offset:a,targetHeight:i?.naturalHeight??s.height,targetWidth:i?.naturalWidth??s.width}),v=d?me({containerHeight:s.height,containerLeft:s.left,containerTop:s.top,containerWidth:s.width,hasScalableSrc:r,objectFit:h.objectFit,objectPosition:h.objectPosition,offset:a,targetHeight:i.naturalHeight,targetWidth:i.naturalWidth}):void 0,E=p?ue({backgroundPosition:h.backgroundPosition,backgroundSize:h.backgroundSize,containerHeight:s.height,containerLeft:s.left,containerTop:s.top,containerWidth:s.width,hasScalableSrc:r,offset:a,targetHeight:i.naturalHeight,targetWidth:i.naturalWidth}):void 0,c=Object.assign({},f,v,E);if(o){const w=window.innerWidth/2,z=window.innerHeight/2,b=parseFloat(String(c.left||0))+parseFloat(String(c.width||0))/2,I=parseFloat(String(c.top||0))+parseFloat(String(c.height||0))/2,L=w-b,C=z-I;m&&(c.transitionDuration="0.01ms"),c.transform=`translate(${L}px,${C}px) scale(1)`}return c},ve=t=>{if(!t)return{};if(D(t)){const e=t.parentElement,n=t.getBoundingClientRect();if(e){const o=e.getBoundingClientRect();return{height:n.height,left:o.left-n.left,top:o.top-n.top,width:n.width}}else return{height:n.height,left:n.left,width:n.width,top:n.top}}else return{height:t.offsetHeight,left:t.offsetLeft,width:t.offsetWidth,top:t.offsetTop}},we=["img","svg",'[role="img"]',"[data-zoom]"].map(t=>`${t}:not([aria-hidden="true"])`).join(","),F={overflow:"",width:""};function ge(t){return l.createElement(_,{...t})}class _ extends l.Component{constructor(){super(...arguments),this.state={id:"",isZoomImgLoaded:!1,loadedImgEl:void 0,modalState:"UNLOADED",shouldRefresh:!1},this.refContent=l.createRef(),this.refDialog=l.createRef(),this.refModalContent=l.createRef(),this.refModalImg=l.createRef(),this.refWrap=l.createRef(),this.imgEl=null,this.isScaling=!1,this.prevBodyAttrs=F,this.styleModalImg={},this.getDialogContainer=()=>{let e=document.querySelector("[data-rmiz-portal]");return e==null&&(e=document.createElement("div"),e.setAttribute("data-rmiz-portal",""),document.body.appendChild(e)),e},this.setId=()=>{const e=()=>Math.random().toString(16).slice(-4);this.setState({id:e()+e()+e()})},this.setAndTrackImg=()=>{const e=this.refContent.current;e&&(this.imgEl=e.querySelector(we),this.imgEl?(this.changeObserver?.disconnect?.(),this.imgEl?.addEventListener?.("load",this.handleImgLoad),this.imgEl?.addEventListener?.("click",this.handleZoom),this.state.loadedImgEl||this.handleImgLoad(),this.imgElObserver=new ResizeObserver(n=>{const o=n[0];o?.target&&(this.imgEl=o.target,this.setState({}))}),this.imgElObserver.observe(this.imgEl)):this.changeObserver||(this.changeObserver=new MutationObserver(this.setAndTrackImg),this.changeObserver.observe(e,{childList:!0,subtree:!0})))},this.handleIfZoomChanged=e=>{const{isZoomed:n}=this.props;!e&&n?this.zoom():e&&!n&&this.unzoom()},this.handleImgLoad=()=>{const{imgEl:e}=this,n=X(e);if(!n)return;const o=new Image;R(e)&&(o.sizes=e.sizes,o.srcset=e.srcset),o.src=n;const i=()=>{this.setState({loadedImgEl:o})};o.decode().then(i).catch(()=>{if(G(o)){i();return}o.onload=i})},this.handleZoom=()=>{this.hasImage()&&this.props.onZoomChange?.(!0)},this.handleUnzoom=()=>{this.props.onZoomChange?.(!1)},this.handleDialogCancel=e=>{e.preventDefault()},this.handleDialogClick=e=>{(e.target===this.refModalContent.current||e.target===this.refModalImg.current)&&this.handleUnzoom()},this.handleKeyDown=e=>{(e.key==="Escape"||e.keyCode===27)&&(e.preventDefault(),e.stopPropagation(),this.handleUnzoom())},this.handleWheel=e=>{e.ctrlKey||(e.stopPropagation(),queueMicrotask(()=>{this.handleUnzoom()}))},this.handleTouchStart=e=>{if(e.touches.length>1){this.isScaling=!0;return}e.changedTouches.length===1&&e.changedTouches[0]&&(this.touchYStart=e.changedTouches[0].screenY)},this.handleTouchMove=e=>{const n=window.visualViewport?.scale??1;if(this.props.canSwipeToUnzoom&&!this.isScaling&&n<=1&&this.touchYStart!=null&&e.changedTouches[0]){this.touchYEnd=e.changedTouches[0].screenY;const o=Math.max(this.touchYStart,this.touchYEnd),i=Math.min(this.touchYStart,this.touchYEnd);Math.abs(o-i)>this.props.swipeToUnzoomThreshold&&(this.touchYStart=void 0,this.touchYEnd=void 0,this.handleUnzoom())}},this.handleTouchEnd=()=>{this.isScaling=!1,this.touchYStart=void 0,this.touchYEnd=void 0},this.handleTouchCancel=()=>{this.isScaling=!1,this.touchYStart=void 0,this.touchYEnd=void 0},this.handleResize=()=>{this.setState({shouldRefresh:!0})},this.hasImage=()=>this.imgEl&&(this.state.loadedImgEl||D(this.imgEl))&&window.getComputedStyle(this.imgEl).display!=="none",this.zoom=()=>{this.bodyScrollDisable(),this.refDialog.current?.showModal?.(),this.setState({modalState:"LOADING"}),this.loadZoomImg(),window.addEventListener("wheel",this.handleWheel,{passive:!0}),window.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),window.addEventListener("touchmove",this.handleTouchMove,{passive:!0}),window.addEventListener("touchend",this.handleTouchEnd,{passive:!0}),window.addEventListener("touchcancel",this.handleTouchCancel,{passive:!0}),document.addEventListener("keydown",this.handleKeyDown,!0),this.refModalImg.current?.addEventListener?.("transitionend",this.handleZoomEnd,{once:!0})},this.handleZoomEnd=()=>{setTimeout(()=>{this.setState({modalState:"LOADED"}),window.addEventListener("resize",this.handleResize,{passive:!0})},0)},this.unzoom=()=>{this.setState({modalState:"UNLOADING"}),window.removeEventListener("wheel",this.handleWheel),window.removeEventListener("touchstart",this.handleTouchStart),window.removeEventListener("touchmove",this.handleTouchMove),window.removeEventListener("touchend",this.handleTouchEnd),window.removeEventListener("touchcancel",this.handleTouchCancel),document.removeEventListener("keydown",this.handleKeyDown,!0),this.refModalImg.current?.addEventListener?.("transitionend",this.handleUnzoomEnd,{once:!0})},this.handleUnzoomEnd=()=>{setTimeout(()=>{window.removeEventListener("resize",this.handleResize),this.setState({shouldRefresh:!1,modalState:"UNLOADED"}),this.refDialog.current?.close?.(),this.bodyScrollEnable()},0)},this.bodyScrollDisable=()=>{this.prevBodyAttrs={overflow:document.body.style.overflow,width:document.body.style.width};const e=document.body.clientWidth;document.body.style.overflow="hidden",document.body.style.width=`${e}px`},this.bodyScrollEnable=()=>{document.body.style.width=this.prevBodyAttrs.width,document.body.style.overflow=this.prevBodyAttrs.overflow,this.prevBodyAttrs=F},this.loadZoomImg=()=>{const{props:{zoomImg:e}}=this,n=e?.src;if(n){const o=new Image;o.sizes=e?.sizes??"",o.srcset=e?.srcSet??"",o.src=n;const i=()=>{this.setState({isZoomImgLoaded:!0})};o.decode().then(i).catch(()=>{if(G(o)){i();return}o.onload=i})}},this.UNSAFE_handleSvg=()=>{const{imgEl:e,refModalImg:n,styleModalImg:o}=this;if(D(e)){const i=document.createElement("div");i.innerHTML=e.outerHTML,i.querySelectorAll("[id]").forEach(m=>{const u=m.id+"-zoom";["clip-path","fill","mask","marker-start","marker-mid","marker-end"].forEach(s=>{i.querySelectorAll(`[${s}="url(#${m.id})"]`).forEach(h=>{h.setAttribute(s,`url(#${u})`)})}),m.id=u});const a=i.firstChild;a.style.width=`${o.width||0}px`,a.style.height=`${o.height||0}px`,a.addEventListener("click",this.handleUnzoom),n.current?.firstChild?.remove?.(),n.current?.appendChild?.(a)}}}render(){const{handleDialogCancel:e,handleDialogClick:n,handleUnzoom:o,handleZoom:i,imgEl:a,props:{a11yNameButtonUnzoom:m,a11yNameButtonZoom:u,children:r,classDialog:s,IconUnzoom:h,IconZoom:p,isZoomed:d,wrapElement:f,ZoomContent:v,zoomImg:E,zoomMargin:c},refContent:w,refDialog:z,refModalContent:b,refModalImg:I,refWrap:L,state:{id:C,isZoomImgLoaded:q,loadedImgEl:K,modalState:y,shouldRefresh:V}}=this,Z=`rmiz-modal-${C}`,O=`rmiz-modal-img-${C}`,j=N(a),U=R(a),Y=D(a),A=he(a),$=X(a),Q=U?a.sizes:void 0,J=U?a.srcset:void 0,W=!!E?.src,M=this.hasImage(),H=A?`${u}: ${A}`:u,ee=y==="LOADING"||y==="LOADED",te=M?"found":"not-found",oe=y==="UNLOADED"||y==="UNLOADING"?"hidden":"visible",ne={visibility:y==="UNLOADED"?"visible":"hidden"},se=ve(a);this.styleModalImg=M?pe({hasZoomImg:W,imgSrc:$,isSvg:Y,isZoomed:d&&ee,loadedImgEl:K,offset:c,shouldRefresh:V,targetEl:a}):{};let k=null;if(M){const x=U||j?l.createElement("img",{alt:A,sizes:Q,src:$,srcSet:J,...q&&y==="LOADED"?E:{},"data-rmiz-modal-img":"",height:this.styleModalImg.height||void 0,id:O,ref:I,style:this.styleModalImg,width:this.styleModalImg.width||void 0}):Y?l.createElement("div",{"data-rmiz-modal-img":!0,ref:I,style:this.styleModalImg}):null,B=l.createElement("button",{"aria-label":m,"data-rmiz-btn-unzoom":"",onClick:o,type:"button"},l.createElement(h,null));k=v?l.createElement(v,{buttonUnzoom:B,modalState:y,img:x,onUnzoom:o}):l.createElement(l.Fragment,null,x,B)}return l.createElement(f,{"aria-owns":Z,"data-rmiz":"",ref:L},l.createElement(f,{"data-rmiz-content":te,ref:w,style:ne},r),M&&l.createElement(f,{"data-rmiz-ghost":"",style:se},l.createElement("button",{"aria-label":H,"data-rmiz-btn-zoom":"",onClick:i,type:"button"},l.createElement(p,null))),M&&ie.createPortal(l.createElement("dialog",{"aria-labelledby":O,"aria-modal":"true",className:s,"data-rmiz-modal":"",id:Z,onClick:n,onClose:o,onCancel:e,ref:z,role:"dialog"},l.createElement("div",{"data-rmiz-modal-overlay":oe}),l.createElement("div",{"data-rmiz-modal-content":"",ref:b},k)),this.getDialogContainer()))}componentDidMount(){this.setId(),this.setAndTrackImg(),this.handleImgLoad(),this.UNSAFE_handleSvg()}componentWillUnmount(){this.state.modalState!=="UNLOADED"&&this.bodyScrollEnable(),this.changeObserver?.disconnect?.(),this.imgElObserver?.disconnect?.(),this.imgEl?.removeEventListener?.("load",this.handleImgLoad),this.imgEl?.removeEventListener?.("click",this.handleZoom),this.refModalImg.current?.removeEventListener?.("transitionend",this.handleZoomEnd),this.refModalImg.current?.removeEventListener?.("transitionend",this.handleUnzoomEnd),window.removeEventListener("wheel",this.handleWheel),window.removeEventListener("touchstart",this.handleTouchStart),window.removeEventListener("touchmove",this.handleTouchMove),window.removeEventListener("touchend",this.handleTouchEnd),window.removeEventListener("touchcancel",this.handleTouchCancel),window.removeEventListener("resize",this.handleResize),document.removeEventListener("keydown",this.handleKeyDown,!0)}componentDidUpdate(e){this.UNSAFE_handleSvg(),this.handleIfZoomChanged(e.isZoomed)}}_.defaultProps={a11yNameButtonUnzoom:"Minimize image",a11yNameButtonZoom:"Expand image",canSwipeToUnzoom:!0,IconUnzoom:ae,IconZoom:re,swipeToUnzoomThreshold:10,wrapElement:"div",zoomMargin:0};function Le(t){const[e,n]=l.useState(!1);return l.createElement(ge,{...t,isZoomed:e,onZoomChange:n})}export{Le as default};
